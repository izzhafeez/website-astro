---
import NavBar from "../../../../components/common/NavBar.astro";
import DateForm from "../../../../components/meetupmaker/DateForm.vue";
import Layout from "../../../../layouts/Layout.astro";
import PreferenceForm from "../../../../components/meetupmaker/PreferenceForm.vue";
import Finalised from "../../../../components/meetupmaker/Finalised.vue";
import { SEO } from 'astro-seo';
import appsData from "../../../../data/apps/apps.json";
import seoImg from "../../../../img/heroes/MEETUPMAKER.jpg";

export const prerender = false;
const id = Astro.url.searchParams.get('id');
const data = await fetch(`${import.meta.env.PUBLIC_MM}/api/apps/meetupmaker/dates/${id}`).then(res => res.json());
const dates = data.dates;
const participants = data.participants;
const meetupName = data.meetup_name;
const passwordHash = data.password_hash;
const hostName = data.host_name;
const date = data.date;
const recommendations = data.recommendations;
const timing = data.timing;
const location = data.location;
const heroText = appsData.meetupmaker.heroText;
---

<SEO
  title={`MeetupMaker | Izz Hafeez`}
  description={heroText}
  canonical={`https://izzhafeez.com/apps/meetupmaker/meetup?id=${id}`}
  openGraph={{
    basic: {
      title: `MeetupMaker | Izz Hafeez`,
      type: "website",
      image: seoImg.src,
      url: `https://izzhafeez.com/apps/meetupmaker/meetup?id=${id}`,
    }
  }}
  extend={{
    // extending the default link tags
    link: [{ rel: "icon", href: "/favicon.png" }],
    // extending the default meta tags
    meta: [
      {
        name: "twitter:image",
        content: seoImg.src,
      },
      { name: "twitter:title", content: `MeetupMaker | Izz Hafeez`},
      { name: "twitter:description", content: heroText },
    ],
  }}
/>

<Layout>
  <div slot="main">
    <NavBar/>
    <!-- if date exists -->    
    {!date && !timing && <DateForm client:only="vue" dates={dates} id={id} meetupName={meetupName} participants={participants} passwordHash={passwordHash}/>}
    <!-- if date does not exist -->
    {date && !timing && <PreferenceForm client:only="vue" date={date} id={id} meetupName={meetupName} participants={participants} passwordHash={passwordHash} recommendations={recommendations}/>}
    <!-- if date and timing exist -->
    {date && timing && <Finalised client:load id={id} participants={participants} hostName={hostName} meetupName={meetupName} timing={timing} date={date} location={location}/>}
  </div>
</Layout>
<link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-minimal@4/minimal.css" rel="stylesheet">
<script is:inline src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>